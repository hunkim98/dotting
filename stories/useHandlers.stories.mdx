import { Meta } from "@storybook/addon-docs";
import Code from "./assets/code-brackets.svg";
import Colors from "./assets/colors.svg";
import Comments from "./assets/comments.svg";
import Direction from "./assets/direction.svg";
import Flow from "./assets/flow.svg";
import Plugin from "./assets/plugin.svg";
import Repo from "./assets/repo.svg";
import StackAlt from "./assets/stackalt.svg";
import Dotting from "../src/components/Dotting";
import {
  StrokeListener,
  HoverPixelListener,
  CanvasElementEvents,
  DataChangeListener,
  CanvasInfoChangeListener,
} from "./useHandlersComponents";

<Meta title="Hooks/useHandlers" />

<style>
  {`
  .subheading {
    --mediumdark: '#999999';
    font-weight: 900;
    font-size: 13px;
    color: #999;
    letter-spacing: 6px;
    line-height: 24px;
    text-transform: uppercase;
    margin-bottom: 12px;
    margin-top: 40px;
    font-family: 'Nunito Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  }

  .link-list {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr 1fr;
    row-gap: 10px;
  }

  @media (min-width: 620px) {
    .link-list {
      row-gap: 20px;
      column-gap: 20px;
      grid-template-columns: 1fr 1fr;
    }
  }

  @media all and (-ms-high-contrast:none) {
  .link-list {
      display: -ms-grid;
      -ms-grid-columns: 1fr 1fr;
      -ms-grid-rows: 1fr 1fr;
    }
  }

  .link-item {
    display: block;
    padding: 20px 30px 20px 15px;
    border: 1px solid #00000010;
    border-radius: 5px;
    transition: background 150ms ease-out, border 150ms ease-out, transform 150ms ease-out;
    color: #333333;
    display: flex;
    align-items: flex-start;
  }

  .link-item:hover {
    border-color: #1EA7FD50;
    transform: translate3d(0, -3px, 0);
    box-shadow: rgba(0, 0, 0, 0.08) 0 3px 10px 0;
  }

  .link-item:active {
    border-color: #1EA7FD;
    transform: translate3d(0, 0, 0);
  }

  .link-item strong {
    font-weight: 700;
    display: block;
    margin-bottom: 2px;
  }
  
  .link-item img {
    height: 40px;
    width: 40px;
    margin-right: 15px;
    flex: none;
  }

  .link-item span {
    font-size: 14px;
    line-height: 20px;
  }

  .tip {
    display: inline-block;
    border-radius: 1em;
    font-size: 11px;
    line-height: 12px;
    font-weight: 700;
    background: #E7FDD8;
    color: #66BF3C;
    padding: 4px 12px;
    margin-right: 10px;
    vertical-align: top;
  }

  .tip-wrapper {
    font-size: 13px;
    line-height: 20px;
    margin-top: 40px;
    margin-bottom: 40px;
  }

  .tip-wrapper code {
    font-size: 12px;
    display: inline-block;
  }
  
table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid #cccccc;
  margin: 15px auto;
  margin-bottom: 80px;
  background: white;
  color: #333333;
  font-family: "Nunito Sans",-apple-system,".SFNSText-Regular","San Francisco",BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Helvetica,Arial,sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

thead {
  border-bottom: 1px solid #cccccc;
}

table .css-1p8ieni {
  margin: 0;
}

h4 {
  margin-top: 15px;
}

th {
  background: steelblue;
  height: 54px;
  width: 25%;
  font-weight: lighter;
  text-shadow: 0 1px 0 #38678f;
  color: white;
  border: 1px solid black;
  box-shadow: inset 0px 1px 2px #cccccc;
  transition: all 0.2s;
}
tr {
  border-bottom: 1px solid #cccccc;
}
tr:last-child {
  border-bottom: 0px;
}
td {
  border-right: 1px solid #cccccc;
  padding: 10px;
  transition: all 0.2s;
  font-size: 14px;
}
td:first-child {
  font-size: 12px;
  font-family: monospace

}
td:last-child {
  border-right: 0px;
}
td.selected {
  background: #d7e4ef;
  z-index: ;
}
td input {
  font-size: 14px;
  background: none;
  outline: none;
  border: 0;
  display: table-cell;
  height: 100%;
  width: 100%;
}
td input:focus {
  box-shadow: 0 1px 0 steelblue;
  color: steelblue;
}
::-moz-selection {
  background: steelblue;
  color: white;
}
::selection {
  background: steelblue;
  color: white;
}
`}
</style>

# `useHandlers`

With `useHandlers`, you can add event listeners to the canvas.
The events that you can listen to are:

- `data change`
- `grid change`
- `stroke end`
- `hover pixel change`
- `brush change`

#### Features provided by `useHandlers`

<table>
  <thead>
    <tr>
      <td></td>
      <td>
        <strong>Description</strong>
      </td>
      <td>
        <strong>Parameters</strong>
      </td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`addDataChangeListener`</td>
      <td>
        Allows you to listen to data change events. This event is triggered when the user draws on the canvas.
        The `delta` parameter tells you the exact changes that happened on the canvas.
      </td>
      <td> 
        `CanvasDataChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section1");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 1</u>.
      </td>
    </tr>
    <tr>
      <td>`removeDataChangeListener`</td>
      <td>
        Allows you to remove a data change listener
      </td>
      <td>`CanvasDataChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section1");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 1</u>.</td>
    </tr>
    <tr>
      <td>`addGridChangeListener`</td>
      <td>
        Allows you to the listen to grid change events.
      </td>
      <td>
        `CanvasGridChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section2");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 2</u>.
      </td>
    </tr>
    <tr>
      <td>`removeGridChangeListener`</td>
      <td>
        Allows you to remove a grid change listener
      </td>
      <td>`CanvasGridChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section2");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 2</u>.</td>
    </tr>
    <tr>
      <td>`addBrushChangeListener`</td>
      <td>
        Allows you to listen to brush change events
      </td>
      <td>
        `CanvasBrushChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section3");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 3</u>.
      </td>
    </tr>
    <tr>
      <td>`removeBrushChangeListener`</td>
      <td>
        Allows you to remove a brush change listener
      </td>
      <td>`CanvasBrushChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section3");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 3</u>.</td>
    </tr>
    <tr>
      <td>`addStrokeEndListener`</td>
      <td>
        Allows you to add a listener to stroke end events
      </td>
      <td>
        `CanvasStrokeEndHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section4");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 4</u>.
      </td>
    </tr>
    <tr>
      <td>`removeStrokeEndListener`</td>
      <td>
        Allows you to remove a stroke end listener
      </td>
      <td>`CanvasStrokeEndHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section4");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 4</u>.</td>
    </tr>
    <tr>
      <td>`addHoverPixelChangeListener`</td>
      <td>
        Allows you to listen to hover pixel change events
      </td>
      <td>
        `CanvasHoverPixelChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section5");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 5</u>.

      </td>
    </tr>
    <tr>
      <td>`removeHoverPixelChangeListener`</td>
      <td>
        Allows you to remove pixel change listener
      </td>
      <td>`CanvasHoverPixelChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section5");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 5</u>.</td>
    </tr>
     <tr>
      <td>`addCanvasElementEventListener`</td>
      <td>
        Allows you to directly add event listeners to the canvas element (E.g. `mousemove`)
      </td>
      <td>`string`, `EventListenerOrEventListenerObject` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section6");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 6</u>.</td>
    </tr>
     <tr>
      <td>`removeCanvasElementEventListener`</td>
      <td>
        Allows you to directly remove event listeners from the canvas element
      </td>
      <td>`string`, `EventListenerOrEventListenerObject` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section6");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 6</u>.</td>
    </tr>
    <tr>
      <td>`addCanvasInfoChangeListener`</td>
      <td>
        Allows you to listen to canvas info `panZoom`, `topLeftCornerOffset`, `topRightCornerOffset`, `bottomLeftCornerOffset`, `bottomRightCornerOffset`, `gridSquareSize` change events
      </td>
      <td>`CanvasInfoChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section7");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 7</u>.</td>
    </tr>
     <tr>
      <td>`removeCanvasInfoChangeListener`</td>
      <td>
        Allows you to remove listeners of canvas info change events
      </td>
      <td>`CanvasInfoChangeHandler` For more information about the type, please refer to
        <u onClick={() => {
          const el = document.getElementById("section7");
          if (el) {
            el.scrollIntoView({ behavior: "smooth" });
          }
        }} style={{cursor: "pointer"}}>section 7</u>.</td>
    </tr>

  </tbody>
</table>

### Examples

<div id="section1"></div>
#### 1. Data change listener

`addDataChangeListener`, `removeDataChangeListener`

With data change listeners, you can observe the changes when the user draws on the canvas.
You can check the `delta` parameter to see the exact changes that happened on the canvas.

The params you should pass to the listener is `CanvasDataChangeParams`:

```ts
export type CanvasDataChangeParams = {
  isLocalChange: boolean;
  data: DottingData;
  layerId: string;
  delta?: CanvasDelta;
};

export type CanvasDataChangeHandler = (params: CanvasDataChangeParams) => void;
```

`DottingData` is a map of `rowIndex` to `columnIndex` to `PixelData`
It contains information about the current colored areas of the canvas:

```ts
export type DottingData = Map<number, Map<number, PixelData>>;

export type PixelData = {
  color: string;
};
```

`CanvasDelta` is an object that contains information about the changes that happened on the canvas.
The `modifiedPixels` tells you what pixels have been modified.
The `addedOrDeletedRows` and `addedOrDeletedColumns` tell you what rows and columns have been added or deleted.

```ts
export type CanvasDelta = {
  modifiedPixels: Array<PixelModifyItem>;
  addedOrDeletedRows?: Array<{
    isDelete: boolean;
    index: number;
  }>;
  addedOrDeletedColumns?: Array<{
    isDelete: boolean;
    index: number;
  }>;
};
```

<DataChangeListener />

<div id="section2"></div>
#### 2. Grid Change listener

`addGridChangeListener`, `removeGridChangeListener`

With grid change listeners, you can observe changes in the grids

The params you should pass to the listener is `CanvasGridChangeParams`.
With the canvas grid change params, you can know the dimensions and the 4 indices of the canvas grid.

```ts
export type CanvasGridChangeParams = {
  dimensions: {
    columnCount: number;
    rowCount: number;
  };
  indices: {
    topRowIndex: number;
    bottomRowIndex: number;
    leftColumnIndex: number;
    rightColumnIndex: number;
  };
};

export type CanvasGridChangeHandler = (params: CanvasGridChangeParams) => void;
```

<br />

<div id="section3"></div>
#### 3. Brush Change Listener

`addBrushChangeListener`, `removeBrushChangeListener`

Brush change listeners allows you to observe the changes when the user changes the brush tool or the brush color.
The parameter you should pass to the listener is defiend as below

```ts
export type CanvasBrushChangeParams = {
  brushColor: string;
  brushTool: BrushTool;
};

export type CanvasBrushChangeHandler = (
  params: CanvasBrushChangeParams,
) => void;
```

The brush tool is an enum that you can import from the library.
Currently we have four tools

```ts
export enum BrushTool {
  DOT = "DOT",
  ERASER = "ERASER",
  PAINT_BUCKET = "PAINT_BUCKET",
  SELECT = "SELECT",
}
```

<br />

<div id="section4"></div>
#### 4. Stroke end listener{" "}

`addStrokeEndListener`, `removeStrokeEndListener`

With stroke end related listeners, you can observe the changes when the user ends the stroke.

The stroke end listener tells you whate pixels were stroked and what tool was used for stroking them
Additionally you can get the `DottingData` which is a map of `rowIndex` to `columnIndex` to `PixelData`

The params you should pass to the listener is `CanvasStrokeEndParams`:

```ts
export type CanvasStrokeEndParams = {
  strokedPixels: Array<ColorChangeItem>;
  data: DottingData;
  strokeTool: BrushTool;
};

export type CanvasStrokeEndHandler = (params: CanvasStrokeEndParams) => void;
```

The `ColorChangeItem` is defined as below.
You are able to get the previous color and the current color of the pixel.

```ts
export interface ColorChangeItem {
  rowIndex: number;
  columnIndex: number;
  color: string;
  previousColor: string;
}
```

The `DottingData` is defined as below.
It is a map of `rowIndex` to `columnIndex` to `PixelData`.

```ts
export type DottingData = Map<number, Map<number, PixelData>>;
export type PixelData = {
  color: string;
};
```

<StrokeListener />

<div id="section5"></div>
#### 5. Hover Pixel Change Listener{" "}

`addHoverPixelChangeListener`, `removeHoverPixelChangeListener`

With the hover pixel change listener, you can observe the changes when the user hovers over the canvas.
When there is no hovered pixel, the return value will be `null`

The params you should pass to the listener is `CanvasHoverPixelChangeHandler`:

```ts
export type CanvasHoverPixelChangeHandler = ({
  indices: {
    rowIndex: number;
    columnIndex: number;
  } | null
}) => void;
```

<HoverPixelListener />

<div id="section6"></div>
#### 6. Canvas Element Custom Event Listener

`addCanvasElementEventListener`, `removeCanvasElementEventListener`

You can also directly add event listeners to the canvas element.
This is useful when you want to listen to events that are not provided by the library.

The parameter you should pass to the listener is `CanvasElementEventParams`:

```ts
export type CanvasElementEventParams = {
  eventName: string;
  listener: EventListenerOrEventListenerObject;
};
```

<CanvasElementEvents />

<div id="section7"></div>
#### 7. Canvas Info Change Event Listener

`addCanvasElementEventListener`,`removeCanvasElementEventListener`

You can listen to canvas info change events with `addCanvasInfoChangeListener`.
The info you can get from the event is:

```ts
export type CanvasInfoChangeParams = {
  panZoom: PanZoom;
  topLeftCornerOffset: Coord;
  topRightCornerOffset: Coord;
  bottomLeftCornerOffset: Coord;
  bottomRightCornerOffset: Coord;
  gridSquareSize: number;
};
```

The PanZoom object is:

```ts
export type PanZoom = {
  scale: number;
  offset: Coord;
};
```

and the Coord object is:

```ts
export interface Coord {
  x: number;
  y: number;
}
```

<CanvasInfoChangeListener />

<div className="subheading">Example Source Codes</div>

<div className="link-list">

<a
  className="link-item"
  href="https://github.com/hunkim98/dotting/tree/main/stories/useHandlersComponent"
  target="_blank"
>
  <img src={StackAlt} alt="Build" />
  <span>
    <strong>Github Source Code</strong>
    View the source code and contribute to the project!
  </span>
</a>

</div>

<div className="tip-wrapper">
  {/* <span className="tip">Tip</span>Edit the Markdown in{" "}
  <code>src/stories/Introduction.stories.mdx</code> */}
</div>
```
